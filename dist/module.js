/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","lodash","@grafana/runtime","@grafana/data"],(function(e,t,n,r,o){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=5)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t,n){"use strict";n.r(t);var r=n(4),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};var c=n(3),s=n(2),u=n.n(s);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.query=function(t){return t.targets.forEach((function(e){e.query=d(e,t)})),e.prototype.query.call(this,t)},t.prototype.metricFindQuery=function(e,t){var n={from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:[{datasource:this.name,datasourceId:this.id,query:d(e,t)}]};return Object(c.getBackendSrv)().post("/api/ds/query",n).then((function(e){return e.results.A.frames[0].data.values[0]})).then(f)},t}(c.DataSourceWithBackend);function f(e){return u.a.map(e,(function(e,t){return e&&e.text&&e.value?{text:e.text,value:e.value}:u.a.isObject(e)?{text:e,value:t}:{text:e,value:e}}))}function d(e,t){void 0===e.query&&(e.query="");var n=Object(c.getTemplateSrv)().replace(e.query,t.scopedVars,(function(e,t){if("object"===l(e)&&(t.multi||t.includeAll)){var n=[];return e.forEach((function(e){t.name===t.label?n.push('"'+t.name+'":"'+e+'"'):n.push('"'+e+'"')})),n.join(" OR ")}return u.a.isArray(e)?e.join(" OR "):e})),r=n.match(/\$([0-9]+)([dmhs])/g);return u()(r).forEach((function(e){var t=e,r=1;-1!==(e=e.replace("$","")).indexOf("s")?r=1:-1!==e.indexOf("m")?r=60:-1!==e.indexOf("h")?r=3600:-1!==e.indexOf("d")&&(r=86400),e=e.replace(/[smhd]/g,"");var o=parseInt(e,10);o*=r,console.log(t,o,e,r,n),n=n.replace(t,String(o))})),-1!==n.indexOf("#time_end")&&(n=n.replace("#time_end",String(t.range.to.unix()/1e3))),-1!==n.indexOf("#time_begin")&&(n=n.replace("#time_begin",String(t.range.from.unix()/1e3))),n}var g=n(0),h=n.n(g),y=n(1),m=y.LegacyForms.SecretFormField,v=y.LegacyForms.FormField,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onEndpointChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options;o.url=e.target.value,r(i({},o))},t.onProjectChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options,a=i(i({},o.jsonData),{project:e.target.value});r(i(i({},o),{jsonData:a}))},t.onLogStoreChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options,a=i(i({},o.jsonData),{logstore:e.target.value});r(i(i({},o),{jsonData:a}))},t.onAKIDChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options,a="";void 0!==o.secureJsonData&&o.secureJsonData.hasOwnProperty("accessKeySecret")&&(a=o.secureJsonData.accessKeySecret),r(i(i({},o),{secureJsonData:{accessKeyId:e.target.value,accessKeySecret:a}}))},t.onAKSecretChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options,a="";void 0!==o.secureJsonData&&o.secureJsonData.hasOwnProperty("accessKeyId")&&(a=o.secureJsonData.accessKeyId),r(i(i({},o),{secureJsonData:{accessKeyId:a,accessKeySecret:e.target.value}}))},t.onResetAKID=function(){var e=t.props,n=e.onOptionsChange,r=e.options;n(i(i({},r),{secureJsonFields:i(i({},r.secureJsonFields),{accessKeyId:!1}),secureJsonData:i(i({},r.secureJsonData),{accessKeyId:""})}))},t.onResetAKSecret=function(){var e=t.props,n=e.onOptionsChange,r=e.options;n(i(i({},r),{secureJsonFields:i(i({},r.secureJsonFields),{accessKeySecret:!1}),secureJsonData:i(i({},r.secureJsonData),{accessKeySecret:""})}))},t}return a(t,e),t.prototype.render=function(){var e=this.props.options,t=e.jsonData,n=e.secureJsonFields,r=e.url,o=e.secureJsonData||{};return h.a.createElement("div",{className:"gf-form-group"},h.a.createElement("div",{className:"gf-form"},h.a.createElement(v,{label:"Endpoint",labelWidth:8,inputWidth:25,onChange:this.onEndpointChange,value:r||"",placeholder:"json field returned to frontend"})),h.a.createElement("div",{className:"gf-form-inline"},h.a.createElement(v,{label:"Project",labelWidth:8,inputWidth:25,onChange:this.onProjectChange,value:t.project||"",placeholder:"json field returned to frontend"})),h.a.createElement("div",{className:"gf-form-inline"},h.a.createElement(v,{label:"Logstore",labelWidth:8,inputWidth:25,onChange:this.onLogStoreChange,value:t.logstore||"",placeholder:"json field returned to frontend"})),h.a.createElement("div",{className:"gf-form-inline"},h.a.createElement("div",{className:"gf-form"},h.a.createElement(m,{isConfigured:n&&n.accessKeyId,value:o.accessKeyId||"",label:"AccessKeyId",placeholder:"secure json field (backend only)",labelWidth:8,inputWidth:25,onReset:this.onResetAKID,onChange:this.onAKIDChange}))),h.a.createElement("div",{className:"gf-form-inline"},h.a.createElement("div",{className:"gf-form"},h.a.createElement(m,{isConfigured:n&&n.accessKeySecret,value:o.accessKeySecret||"",label:"AccessKeySecret",placeholder:"secure json field (backend only)",labelWidth:8,inputWidth:25,onReset:this.onResetAKSecret,onChange:this.onAKSecretChange}))))},t}(g.PureComponent),C={query:"* | select count(*) as c, __time__-__time__%60 as t group by t",xcol:"t",ycol:"c",logsPerPage:100,currentPage:1},O=y.LegacyForms.FormField,S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onQueryTextChange=function(e){var n=t.props,r=n.onChange,o=n.query;r(i(i({},o),{query:e.target.value}))},t.onXChange=function(e){var n=t.props,r=n.onChange,o=n.query,a=n.onRunQuery;r(i(i({},o),{xcol:e.target.value})),a()},t.onYChange=function(e){var n=t.props,r=n.onChange,o=n.query,a=n.onRunQuery;r(i(i({},o),{ycol:e.target.value})),a()},t}return a(t,e),t.prototype.render=function(){var e=Object(s.defaults)(this.props.query,C),t=e.query,n=e.xcol,r=e.ycol;return h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"gf-form-inline"},h.a.createElement(O,{labelWidth:6,inputWidth:30,value:t,onChange:this.onQueryTextChange,label:"query"})),h.a.createElement("div",{className:"gf-form-inline"},h.a.createElement(O,{labelWidth:6,inputWidth:11,value:r,onChange:this.onYChange,label:"ycol"}),h.a.createElement(O,{labelWidth:6,inputWidth:12,value:n,onChange:this.onXChange,label:"xcol(time)"})))},t}(g.PureComponent),j=y.LegacyForms.FormField,x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onQueryTextChange=function(e){var n=t.props,r=n.onChange,o=n.query;r(i(i({},o),{query:e.target.value}))},t}return a(t,e),t.prototype.render=function(){var e=this.props.query.query;return h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"gf-form-inline"},h.a.createElement(j,{labelWidth:6,inputWidth:30,value:e,onChange:this.onQueryTextChange,label:"query"})))},t}(g.PureComponent);n.d(t,"plugin",(function(){return E}));var E=new r.DataSourcePlugin(p).setConfigEditor(b).setQueryEditor(S).setVariableQueryEditor(x)}])}));
//# sourceMappingURL=module.js.map